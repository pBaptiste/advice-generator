---
import { Image } from "astro:assets";
import diceIcon from '../images/icon-dice.svg'
import dividerMobile from '../images/pattern-divider-mobile.svg'
import dividerDesktop from '../images/pattern-divider-desktop.svg'
import ResponsiveImage from "../components/ResponsiveImage.astro";

const response = await fetch('https://api.adviceslip.com/advice');
const data = await response.json();
---

<article class="relative max-w-[343px] md:max-w-[540px] pt-10 md:pt-12 px-6 md:px-12 pb-16 md:pb-[72px] flex flex-col items-center text-center bg-background rounded-[10px] md:rounded-[15px] shadow-app">
    <p id="number" class="text-accent text-[0.688rem] md:text-[0.813rem] font-extrabold tracking-[3.457px] md:tracking-[4.086px] mb-6">ADVICE {'#' + data.slip.id}</p>
    <h1 id="advice" class="text-primary text-2xl md:text-[1.75rem] font-extrabold tracking-[-0.257px] md:tracking-[-0.3px] mb-6 md:mb-10">{data.slip.advice}</h1>
    <ResponsiveImage imgMobile={dividerMobile} imgDesktop={dividerDesktop} alt=""/>

    <button id="generate" type="button" class="absolute bottom-[-30px] left-[50%] -translate-x-[50%] w-16 h-16 rounded-full bg-accent hover:shadow-btn focus:shadow-btn outline-none flex items-center justify-center" aria-label="Generate new advice">
        <Image src={diceIcon} alt='' width={24} height={24} />
    </button>
</article>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        const generateBtn = document.getElementById('generate');
        const adviceNumber = document.getElementById('number') as HTMLElement;
        const adviceText = document.getElementById('advice') as HTMLElement;

        generateBtn?.addEventListener('click', async () => {

            try {
                const response = await fetch('https://api.adviceslip.com/advice');

                if (!response.ok) {
                throw new Error(`Failed to fetch advice. Status: ${response.status}`);
                }

                const data = await response.json();

                adviceNumber.textContent = `Advice #${data.slip.id}`;
                adviceText.textContent = data.slip.advice;
       
            } catch (error: any) {
                console.error('Error fetching advice:', error.message);
            }
         });
    })
</script>